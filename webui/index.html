<!DOCTYPE html>
<html lang="en">
<head>
  <title>ESPAltherma Config</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:,">
  <link rel="stylesheet" type="text/css" href="pico.min.css">
  <link rel="stylesheet" type="text/css" href="main.css">
  <script src="main.js"></script>
</head>
<body>  
  <main class="container">
    <dialog id="loading-dialog" open>
      <article aria-busy="true">
        Loading, please wait...
      </article>
    </dialog>
    <header><h1>ESPAltherma</h1></header>    
    <nav id="nav-main">
      <ul>
        <li><a href="#" data-link="form-config" role="button" >Config</a></li>
        <li><a href="#" data-link="form-update">Update</a></li>
      </ul>
    </nav>
    <article id="form-config" role="tab">
      <form id="configForm" action="/saveConfig" method="post">
        <label for="standalone_wifi" >          
          <input type="checkbox" id="standalone_wifi" name="standalone_wifi" role="switch" onclick="updateWifiFields()"/>
          Use standalone WiFi
        </label>
        <div class="grid">
          <div>
            <label for="ssid">WIFI SSID:</label>
            <input type="text" id="ssid" name="ssid"/>
          </div>
          
          <label for="ssid_select" id="ssidSelectLabel">
            Select a Wifi in range            
            <div class="grid-wifi"  >
              <div class="container-wifilist">
                  <select id="ssid_select" name="ssid_select">
                    <option value="" disabled selected>Select Wifi...</option>
                  </select>
              </div>
              <div class="container-refreshBtn">
                <a href="#" role="button" id="btnWifiListRefresh">&#x21bb;</a>
              </div>
            </div>
          </label>
        </div>

        <label for="ssid_password">WIFI Password:</label>
        <input type="password" id="ssid_password" name="ssid_password"/>
        <small>Leave empty for open networks</small> 

        <label for="ssid_staticip" >          
          <input type="checkbox" id="ssid_staticip" name="ssid_staticip" role="switch" onclick="show('staticip');"/>
          WIFI use static IP
        </label>

        <article id="staticip" class="hidden">
          <div>
            <label for="ssid_ip">WIFI IP:</label>
            <input type="text" id="ssid_ip" name="ssid_ip"/>          

            <label for="ssid_subnet">WIFI Subnet:</label>
            <input type="text" id="ssid_subnet" name="ssid_subnet"/>

            <label for="ssid_gateway">WIFI Gateway:</label>
            <input type="text" id="ssid_gateway" name="ssid_gateway"/>

            <label for="primary_dns">Primary DNS:</label>
            <input type="text" id="primary_dns" name="primary_dns"/>
            <small>Optional</small> 

            <label for="secondary_dns">Secondary DNS:</label>
            <input type="text" id="secondary_dns" name="secondary_dns"/>
            <small>Optional</small> 
        </article>

        <label for="mqtt_server">MQTT Server:</label>
        <input type="text" id="mqtt_server" name="mqtt_server"/>

        <label for="mqtt_username">MQTT Username:</label>
        <input type="text" id="mqtt_username" name="mqtt_username"/>

        <label for="mqtt_password">MQTT Password:</label>
        <input type="password" id="mqtt_password" name="mqtt_password"/>

        <label for="mqtt_jsontable" >          
          <input type="checkbox" id="mqtt_jsontable" name="mqtt_jsontable" role="switch"/>
          MQTT use JSON Table
        </label>

        <label for="mqtt_use_onetopic" >          
          <input type="checkbox" id="mqtt_use_onetopic" name="mqtt_use_onetopic" role="switch" onclick="show('onetopic');"/>
          MQTT one Topic
        </label>

        <article id="onetopic" class="hidden">
          <label for="mqtt_onetopic">MQTT one Topic:</label>
          <input type="text" id="mqtt_onetopic" name="mqtt_onetopic"/>
          <small>Needs to end with a slash</small>
        </article>
        
        <label for="mqtt_port">MQTT Port:</label>
        <input type="number" id="mqtt_port" name="mqtt_port" min="0" max="65535"/>

        <label for="frequency">
          Frequency:
          <select id="frequency" name="frequency">
            <option value="10000">10 sec</option>
            <option value="15000">15 sec</option>
            <option value="30000">30 sec</option>
            <option value="60000">1 min</option>
            <option value="300000">5 min</option>
            <option value="600000">10 min</option>
          </select>
        </label>

        <div class="grid">
          <label for="pin_rx">
            PIN RX
            <select id="pin_rx" name="pin_rx" data-pins></select>
          </label>

          <label for="pin_tx">
            PIN TX
            <select id="pin_tx" name="pin_tx" data-pins></select>
          </label>
        </div>

        <label for="pin_therm">
          PIN THERM
          <select id="pin_therm" name="pin_therm" data-pins>
          </select>                            
        </label>

        <label for="sg_enabled" >          
          <input type="checkbox" id="sg_enabled" name="sg_enabled" role="switch" onclick="show('smartgrid');"/>
          SmartGrid enabled
        </label>

        <article id="smartgrid" class="hidden">
          <div class="grid">
            <label for="pin_sg1">
              PIN SG1
              <select id="pin_sg1" name="pin_sg1" data-pins></select>
            </label>
            
            <label for="pin_sg2">
              PIN SG2
              <select id="pin_sg2" name="pin_sg2" data-pins></select>
            </label>
          </div>

          <label for="sg_relay_trigger" >          
            <input type="checkbox" id="sg_relay_trigger" name="sg_relay_trigger" role="switch"/>
            SG Relay high trigger
          </label>
          <small>Enable if the relay gets enabled when output is high on SG Pins</small>
        </article>

        <label for="pin_enable_config">
          PIN CONFIG PAGE:
          <select id="pin_enable_config" name="pin_enable_config" data-pins></select>
          <small>If the given pinnumber gets connected to ground, ESPAltherma will reboot again in the standalone wifi mode.</small>
        </label>

        <div class="grid">
          <div>
            <label for="model">Model:</label>
            <select id="model" name="model" onchange="refreshLanguages()">
              <option value="" selected>Select a model...</option>
            </select>

            <label for="language">Language:</label>
            <select id="language" name="language" onchange="updatePresets()">
              <option value="" selected>Select a language...</option>
            </select>

            <label for="language">Preset Parameters:</label>
            <select id="presetParameters" name="presetParameters" onchange="updateParameters()">
              <option value="" selected>Select a preset...</option>
            </select>
          </div>          
          <div>            
            <label for="parametersFile">Upload Parameters file:</label>
            <input type="file" id="parametersFile" accept=".json" name="parametersFile"/>
            <small>Add a model config file to the predefined model list</small>

            <input type="button" onclick="uploadFile()" value="Upload">
          </div>
        </div>

        <article id="containerCustomParameters" class="hidden">
          <div class="grid">
            <div class="parametersSection">
              <label for="parametersTable">Parameters:</label>
              <figure >
                <table id="parametersTable">
                  <tr>
                    <td>Name</td>  
                    <td>RegID</td>                
                    <td>Offset</td>                    
                    <td>ConvID</td>
                    <td>Data size</td>
                    <td>Data type</td>
                    <td>Value</td>
                  </tr>                
                </table>
              </figure>

              <input type="button" onclick="addSelectedPredefinedParameters()" value="Add to selected parameters">
              <button id="loadParametersTable" onclick="beginLoadData('parametersTable')">Load model values</button>           
            </div>          
            <div class="parametersSection">
              <label for="selectedParametersTable">Selected Parameters:</label>            
              <figure>
                <table id="selectedParametersTable">
                  <tr>
                    <td>Name</td>  
                    <td>RegID</td>                
                    <td>Offset</td>                    
                    <td>ConvID</td>
                    <td>Data size</td>
                    <td>Data type</td>
                    <td>Value</td>
                  </tr>                
                </table>
              </figure>

              <input type="button" onclick="removeSelectedCustomParameters()" value="Remove from selected parameters" />
              <input type="button" onclick="clearCustomParameters()" value="Remove all parameters" />
              <button id="loadSelectedParametersTable" onclick="beginLoadData('selectedParametersTable')">Load parameter values</button>
            </div>
          </div>
          <div class="customParameterSection">                        
            <details>
              <summary role="button">Add custom Parameter</summary>
              <p>
                <div class="grid">
                  <div>
                    <label for="regid">RegID:</label>
                    <input type="number" id="regid" name="regid" min="0" max="127"/>
                  </div>              
                  <div>
                    <label for="offset">Offset:</label>
                    <input type="number" id="offset" name="offset" min="0" max="31"/>
                  </div>
                  <div >                    
                    <label for="convid">ConvID:</label>
                    <select id="convid" name="convid">
                      <option value="100">100</option>
                      <option value="101">101</option>
                      <option value="102">102</option>
                      <option value="103">103</option>
                      <option value="104">104</option>
                      <option value="105">105</option>
                      <option value="106">106</option>
                      <option value="107">107</option>
                      <option value="108">108</option>
                      <option value="109">109</option>
                      <option value="110">110</option>
                      <option value="111">111</option>
                      <option value="112">112</option>
                      <option value="113">113</option>
                      <option value="114">114</option>
                      <option value="115">115</option>
                      <option value="116">116</option>
                      <option value="117">117</option>
                      <option value="118">118</option>
                      <option value="119">119</option>
                      <option value="151">151</option>
                      <option value="152">152</option>
                      <option value="153">153</option>
                      <option value="154">154</option>
                      <option value="155">155</option>
                      <option value="156">156</option>
                      <option value="157">157</option>
                      <option value="158">158</option>
                      <option value="200">200</option>
                      <option value="201">201</option>
                      <option value="203">203</option>
                      <option value="204">204</option>
                      <option value="211">211</option>
                      <option value="217">217</option>
                      <option value="300">300</option>
                      <option value="301">301</option>
                      <option value="302">302</option>
                      <option value="303">303</option>
                      <option value="304">304</option>
                      <option value="305">305</option>
                      <option value="306">306</option>
                      <option value="307">307</option>
                      <option value="315">315</option>
                      <option value="316">316</option>
                    </select>
                  </div>
                  <div>                  
                    <label for="dataSize">Data size:</label>
                    <select id="dataSize" name="dataSize">
                      <option value="0">0</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                    </select>
                  </div>
                  <div>
                    <label for="dataType">Data type:</label>
                    <select id="dataType" name="dataType">
                      <option value="-1">-1</option>
                      <option value="0">0</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                    </select>
                  </div>
                </div>              

                <label for="dataName">Data name:</label>
                <input type="text" id="dataName" name="dataName"/>

                <input type="button" onclick="addCustomParameter()" value="Add">
              </p>
            </details>
          </div>
        </article>
        
        <p><input type="submit" id="submit" value="SAVE CONFIG" role="button" /></p>
      </form>
      <form id="configForm" action="/uploadConfig" method="post">
        <div class="grid">
          <div>
            <a href="/loadConfig" target="_blank" role="button" class="contrast" id="config-export">Export Config</a>
          </div> 
          <div>
            <input type="file" id="configFile" accept=".json" name="configFile"/>
            <input type="button" onclick="importConfig()" value="Import Config" class="contrast">
          </div>
        </div>                
      </form>
    </article>
    <article id="form-update" role="tab" style="display: none;">
      <h3>OTA</h3>
        <p>
            Select Filetype of the Over-the-Air Update:
            <fieldset>
              <label for="firmware">
                <input type="radio" id="firmware" name="updateType" value="firmware" checked>
                Firmware
              </label>
              <label for="filesystem">
                <input type="radio" id="filesystem" name="updateType" value="filesystem">
                Filesystem
              </label>
            </fieldset>

            <label for="updateFile">Select file:
              <input type="file" id="updateFile" name="updateFile" accept=".bin,.bin.gz">
            </label>

            <p><input type="button" id="startUpdate" value="Start update"/></p>
        </p>
    </article>
  </main>
</body>
</html>